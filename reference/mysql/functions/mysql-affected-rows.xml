<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.12 $ -->
<!-- EN-Revision: 1.17 Maintainer: dams Status: ready -->
<!-- Reviewed: yes -->
 <refentry id="function.mysql-affected-rows">
  <refnamediv>
   <refname>mysql_affected_rows</refname>
   <refpurpose>
    Retourne le nombre de lignes affectées lors de la dernière requête SQL MySQL
   </refpurpose>
  </refnamediv>
  <refsect1>
   &reftitle.description;
    <methodsynopsis>
     <type>int</type><methodname>mysql_affected_rows</methodname>
     <methodparam choice="opt"><type>resource</type><parameter>link_identifier</parameter></methodparam>
    </methodsynopsis>
   <para>
    <function>mysql_affected_rows</function> retourne le nombre de lignes
    affectées lors de la dernière requête INSERT, UPDATE ou
    DELETE sur le serveur associé à l'identifiant de connexion
    <parameter>link_identifier</parameter>. Si
    <parameter>link_identifier</parameter> n'est pas précisé,
    <function>mysql_affected_rows</function> utilise la dernière
    connexion ouverte.
   </para>
   <note>
    <para>
     Si vous utilisez les transactions, vous devez appeler
     <function>mysql_affected_rows</function> après votre INSERT,
     UPDATE, ou DELETE et non après la validation.
    </para>
   </note>
   <para>
    Si la dernière requête était un DELETE sans clause WHERE, tous
    les enregistrements ont été effacés, mais
    <function>mysql_affected_rows</function> va retourner 0.
   </para>
   <note>
    <para>
     Lorsque vous utilisez UPDATE, MySQL ne mettera pas à jour les colonnes si
     la nouvelle valeur est identique à l'ancienne. Cela fait que 
     <function>mysql_affected_rows</function> ne représentera pas forcemment
     le nombre de lignes correspondantes mais plutôt le nombre de lignes
     qui ont été réellement affectées par la requête.
    </para>
    <para>
     La requête REPLACE commence par effacer les enregistrements possédant la même
     clé primaire et ensuite, insert les nouveaux enregistrements. Cette fonction retourne le
     nombre d'enregistrements effacés ainsi que le nombre d'enregistrements insérés.
    </para>
   </note>
   <para>
    Pour recupérer le nombre de lignes retournées par un SELECT, il est également possible
    d'utiliser la fonction <function>mysql_num_rows</function>.
   </para>
    <para>
     Si la dernière requête a échoué,
     <function>mysql_affected_rows</function> retourne -1.
     <example>
      <title>Requête SQL Delete</title>
      <programlisting role="php">
<![CDATA[
<?php
    /* connexion à la base */
    mysql_pconnect("localhost", "mysql_user", "mysql_password") or
        die("Impossible de se connecter : " . mysql_error());

    /* Ceci devrait retourner le nombre correct de lignes effacées */
    mysql_query("DELETE FROM mytable WHERE id < 10");
    printf ("Records deleted: %d\n", mysql_affected_rows());

    /* Sans la clause WHERE, il retourne 0 */
    mysql_query("DELETE FROM mytable");
    printf ("Lignes effacées : %d\n", mysql_affected_rows());
?>
]]>
      </programlisting>
      <para>
       Le script ci-dessus devrait afficher : 
       <screen>
<![CDATA[
Lignes effacées : 10
Lignes effacées : 0
]]>
       </screen>
      </para>
     </example>
     <example>
      <title>Requête SQL Update</title>
      <programlisting role="php">
<![CDATA[
<?php
    /* connexion à la base */
    mysql_pconnect("localhost", "mysql_user", "mysql_password") or
        die("Impossible de se connecter : " . mysql_error());

    /* Requête de modification Update */
    mysql_query("UPDATE mytable SET used=1 WHERE id < 10");
    printf ("Lignes modifiées : %d\n", mysql_affected_rows());
mysql_query("COMMIT");
?>
]]>
      </programlisting>
      <para>
       Le script ci-dessus devrait afficher : 
       <screen>
<![CDATA[
Lignes modifiées : 10
]]>
       </screen>
      </para>
     </example> 
    </para>
    <para>
     Voir aussi
     <function>mysql_num_rows</function> et
     <function>mysql_info</function>.
    </para>
  </refsect1>
 </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
