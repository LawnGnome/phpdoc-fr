<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.1 $ -->
<!-- splitted from ./en/functions/openssl.xml, last change in rev 1.19 -->
  <refentry id="function.openssl-csr-new">
   <refnamediv>
    <refname>openssl_csr_new</refname>
    <refpurpose>G&eacute;n&egrave;re une cl&eacute; priv&eacute;e et un CSR</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Description</title>
     <methodsynopsis>
      <type>bool</type><methodname>openssl_csr_new</methodname>
      <methodparam><type>array</type><parameter>dn</parameter></methodparam>
      <methodparam><type>resource</type><parameter>privkey</parameter></methodparam>
      <methodparam choice="opt"><type>array</type><parameter>configargs</parameter></methodparam>
      <methodparam choice="opt"><type>array</type><parameter>extraattribs</parameter></methodparam>
     </methodsynopsis>
    <para>
     <function>openssl_csr_new</function> g&eacute;n&egrave;re une nouvelle CSR (Certificate Signing Request,
     requ&ecirc;te de signature de certificat), bas&eacute; sur les informations fournies par 
     <parameter>dn</parameter>, qui repr&eacute;sente le nom distingu&eacute; 
     (Distinguished Name) qui doit &ecirc;tre utilis&eacute; pour ce certificat.
    </para>
    <para>
     <parameter>privkey</parameter> doit &ecirc;tre une cl&eacute; priv&eacute;e qui a &eacute;t&eacute;
     g&eacute;n&eacute;r&eacute;e par <function>openssl_pkey_new</function> (ou
     obtenue autrement par l'une des fonctions de la famille openssl_pkey)
     La cl&eacute; publique sera utilis&eacute;e pour signer la CSR.
    </para>
    <para>
     <parameter>extraattribs</parameter> est utilis&eacute; pour sp&eacute;cifier
     des options de configuration suppl&eacute;mentaires pour la CSR.  Les deux
     param&egrave;tres <parameter>dn</parameter> et
     <parameter>extraattribs</parameter> sont des tableaux associatifs dont les
     cl&eacute;s sont converties en OIDs et appliqu&eacute;es aux parties appropri&eacute;es de la 
     requ&ecirc;te.
    </para>
    &reference.openssl.note-openssl-cnf;
    <para>
     Par d&eacute;faut, les informations du fichier <literal>openssl.conf</literal>
     de votre syst&egrave;me sont utilis&eacute;es pour initialiser la requ&ecirc;te; vous pouvez
     sp&eacute;cifier une section du fichier de configuration en utilisant l'index
     <literal>config_section_section</literal> du tableau
     <parameter>configargs</parameter>. Vous pouvez aussi
     sp&eacute;cifier une configuration OpenSSL alternative en utilisant l'index
     <literal>config</literal>, et en lui donnant la valeur du chemin &agrave;
     utiliser. Les index suivants, si fournis dans le param&egrave;tre 
     <parameter>configargs</parameter>, se comportent comme leur &eacute;quivalent
     du fichier <literal>openssl.conf</literal>, tel qu'indiqu&eacute; ci-dessous.
     <table>
      <title>Adaptation des configurations</title>
      <tgroup cols="3">
       <thead>
        <row>
         <entry>Index <parameter>configargs</parameter></entry>
         <entry>Type</entry>
         <entry>Equivalent <literal>openssl.conf</literal></entry>
         <entry>Description</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>digest_alg</entry>
         <entry><link linkend="language.types.string">&string;</link></entry>
         <entry>default_md</entry>
         <entry>S&eacute;lectionne la m&eacute;thode "digest" &agrave; utiliser</entry>
        </row>
        <row>
         <entry>x509_extensions</entry>
         <entry><link linkend="language.types.string">&string;</link></entry>
         <entry>x509_extensions</entry>
         <entry>S&eacute;lectionne quelles extensions doivent &ecirc;tre utilis&eacute;es lors de la
         cr&eacute;ation du certificat x509</entry>
        </row>
        <row>
         <entry>req_extensions</entry>
         <entry><link linkend="language.types.string">&string;</link></entry>
         <entry>req_extensions</entry>
         <entry>S&eacute;lectionne quelles extensions doivent &ecirc;tre utilis&eacute;es lors de la
         cr&eacute;ation d'une CSR</entry>
        </row>
        <row>
         <entry>private_key_bits</entry>
         <entry><link linkend="language.types.integer">integer</link></entry>
         <entry>default_bits</entry>
         <entry>Sp&eacute;cifie le nombre de bits &agrave; utiliser lors de la g&eacute;n&eacute;ration de la 
         cl&eacute; priv&eacute;e</entry>
        </row>
        <row>
         <entry>private_key_type</entry>
         <entry><link linkend="language.types.integer">integer</link></entry>
         <entry>none</entry>
         <entry>Sp&eacute;cifie le type de cl&eacute; priv&eacute;e &agrave; g&eacute;n&eacute;rer. Cela peut &ecirc;tr l'une des
         constantes suivantes : <constant>OPENSSL_KEYTYPE_DSA</constant>,
          <constant>OPENSSL_KEYTYPE_DH</constant> ou
          <constant>OPENSSL_KEYTYPE_RSA</constant>.
          La valeur par d&eacute;faut est <constant>OPENSSL_KEYTYPE_RSA</constant>,
          ce qui est le seul type de cl&eacute; actuellement support&eacute;.
         </entry>
        </row>
        <row>
         <entry>encrypt_key</entry>
         <entry><link linkend="language.types.boolean">booean</link></entry>
         <entry>encrypt_key</entry>
         <entry>Doit &ecirc;tre une cl&eacute;e export&eacute;e (avec mot de passe) qui sera
         chiffr&eacute;e?</entry>
        </row>
       </tbody>
      </tgroup>
     </table>
    </para>
    <simpara>
     &return.success;
    </simpara>
    <para>
     <example>
      <title>Exemple avec <function>openssl_csr_new</function> - cr&eacute;ation d'un 
      certificat auto chiffr&eacute;</title>
      <programlisting role="php">
<![CDATA[
// Assigne les valeurs du nom distingu&eacute; &agrave; utiliser avec le certificat
// Vous devez remplacer les valeurs suivantes pour qu'elles correspondent
// au nom de votre compagnie, ou, plus pr&eacute;cis&eacute;ement, le nom de la personne
// qui repr&eacute;sente le site de votre compagnie pour qui vous g&eacute;n&eacute;rez des
// cl&eacute;s. Pour les certificats SSL, le commonName est g&eacute;n&eacute;ralement le nom de domaine
// pour lequel vous installez le certificat, mais pour les certificats
// le commonName sera le nom de la personne qui utilisera le cerficat.
$dn = array(
    "countryName" => "UK",
    "stateOrProvinceName" => "Somerset",
    "localityName" => "Glastonbury",
    "organizationName" => "The Brain Room Limited",
    "organizationalUnitName" => "PHP Documentation Team",
    "commonName" => "Wez Furlong",
    "emailAddress" => "wez@php.net"
);

// G&eacute;n&egrave;re la cl&eacute; priv&eacute; et publique
$privkey = openssl_pkey_new();

// G&eacute;n&egrave;re la requ&ecirc;te de signature de certificat
$csr = openssl_csr_new($dn, $privkey);

// Vous souhaiterez g&eacute;n&eacute;ralement cr&eacute;er un certificat auto chiffr&eacute;
// une fois que votre autorit&eacute; de certification acc&egrave;de &agrave; votre requ&ecirc;te
// Cette commande cr&eacute;e une certificat auto chiffr&eacute;
$sscert = openssl_csr_sign($csr, null, $privkey, 365);

// Maintenant, vous voulez pr&eacute;server la cl&eacute; secr&ecirc;te, la CSR et le certificat
// auto-chiffr&eacute;, de fa&ccedil;on &agrave; ce qu'ils puissent &ecirc;tre install&eacute;s sur votre
// serveur web, serveur mail ou client mail (suivant l'utilisation).
// Cet exemple vous montre comment placer ces &eacute;l&eacute;ments dans des variables
// mais vous pouvez aussi les mettre directement dans des fichiers.
// Typiquement, vous allez envoyer la CSR &agrave; votre autorit&eacute; de certification
// qui vous &eacute;mettra un "vrai" certificat.
openssl_csr_export($csr, $csrout) and debug_zval_dump($csrout);
openssl_x509_export($sscert, $certout) and debug_zval_dump($certout);
openssl_pkey_export($privkey, $pkeyout, "mypassword") and debug_zval_dump($pkeyout);

// Affiche les erreurs qui sont survenues
while (($e = openssl_error_string()) !== false) {
    echo $e . "\n";
}

]]>
      </programlisting>
     </example>
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
