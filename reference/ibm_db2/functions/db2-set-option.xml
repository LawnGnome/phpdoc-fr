<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.2 $ -->
<!-- EN-Revision: 1.4 Maintainer: jsgoupil Status: ready -->
<!-- Reviewed: no -->
<refentry id="function.db2-set-option">
  <refnamediv>
    <refname>db2_set_option</refname>
    <refpurpose>Fixe des options pour une connexion ou des ressources</refpurpose>
  </refnamediv>
  <refsect1 role="description">
    &reftitle.description;
    <methodsynopsis>
      <!-- All Functions have this -->
      <type>bool</type><methodname>db2_set_option</methodname>

      <!-- Required Parameter (First Param) -->
      <methodparam><type>resource</type><parameter>resource</parameter></methodparam>      

      <!-- Required Parameter (Second Param) -->
      <methodparam><type>array</type><parameter>options</parameter></methodparam>

      <!-- Optional Parameter (Third Param) -->
      <methodparam choice="opt"><type>int</type><parameter>type</parameter></methodparam>
    </methodsynopsis>
    <para>
     Fixe des options pour une ressource ou une connexion. Vous ne pouvez pas
     fixer des options pour un jeu de résultats.
    </para>
  </refsect1>
  <refsect1 role="parameters">
    &reftitle.parameters;
    <para>
      <variablelist>
        <varlistentry>
          <term><parameter>resource</parameter></term>
          <listitem>
            <para>
             Une ressource valide comme retournée par
             <function>db2_prepare</function> ou une connexion valide comme
             retournée par <function>db2_connect</function> ou
             <function>db2_pconnect</function>.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>options</parameter></term>
          <listitem>
            <para>
             Un tableau associatif contenant des options de ressources ou de
             connexion valides. Ce paramètre peut être utilisé pour changer
             les valeurs d'autocommit, types de curseur (flottant ou à avance
             seule) et spécifier la casse des noms de colonne (minuscule,
             majuscule ou naturelle) qui apparaîtra dans le jeu de résultats.
              <variablelist>
                <varlistentry>
                  <term><parameter>autocommit</parameter></term>
                  <listitem>
                    <para>
                     Passer <literal>DB2_AUTOCOMMIT_ON</literal> active
                     l'autocommit pour la connexion spécifiée.
                    </para>
                    <para>
                     Passer <literal>DB2_AUTOCOMMIT_OFF</literal> désactive
                     l'autocommit pour la connexion spécifiée.
                    </para>
                  </listitem>
                </varlistentry>
                <varlistentry>
                  <term><parameter>cursor</parameter></term>
                  <listitem>
                    <para>
                     Passer <literal>DB2_FORWARD_ONLY</literal> spécifie un
                     curseur à avance seule pour une ressource. Ceci est le
                     type de défaut pour un curseur et est supporté par tous
                     les serveurs de base de données.
                    </para>
                    <para>
                     Passer <literal>DB2_SCROLLABLE</literal> spécifie un
                     curseur flottant pour une ressource. Les curseurs
                     flottants permettent aux lignes de résultats d'être
                     accessibles dans un ordre non séquentiel. Ce type de
                     curseur est supporté seulement par les bases de données
                     IBM DB2 Universal Database.
                    </para>
                  </listitem>
                </varlistentry>
                <varlistentry>
                  <term><parameter>binmode</parameter></term>
                  <listitem>
                    <para>
                     Passer <literal>DB2_BINARY</literal> spécifie que des
                     données binaires seront retournées comme telles. Ceci est
                     le mode par défaut. Ceci est équivalent à la
                     configuration <literal>ibm_db2.binmode=1</literal> dans
                     &php.ini;.
                    </para>
                    <para>
                     Passer <literal>DB2_CONVERT</literal> spécifie que les
                     données binaires seront converties en encodage hexadécimal
                     et seront retourné ainsi. Ceci est équivalent à la
                     configuration <literal>ibm_db2.binmode=2</literal> dans
                     &php.ini;.
                    </para>
                    <para>
                     Passer <literal>DB2_PASSTHRU</literal> spécifie que les
                     données binaires seront converties en &null;. 
                     Ceci est équivalent à la
                     configuration <literal>ibm_db2.binmode=3</literal> dans
                     &php.ini;.
                    </para>
                  </listitem>
                </varlistentry>
                <varlistentry>
                  <term><parameter>db2_attr_case</parameter></term>
                  <listitem>
                    <para>
                     Passer <literal>DB2_CASE_LOWER</literal> spécifie que les
                     noms des colonnes dans le jeu de résultats seront
                     retournés en minuscule.
                    </para>
                    <para>
                     Passer <literal>DB2_CASE_UPPER</literal> spécifie que les
                     noms des colonnes dans le jeu de résultats seront
                     retournés en majuscule.
                    </para>
                    <para>
                     Passer <literal>DB2_CASE_NATURAL</literal> spécifie que
                     les noms de colonnes dans le jeu de résultats seront
                     retournés en casse naturelle.
                    </para>
                  </listitem>
                </varlistentry>
              </variablelist>
            </para>
            <para>
             Les nouvelles options suivantes i5/OS sont disponibles depuis la
             version 1.5.1 de ibm_db2.
             Note : les anciennes versions de ibm_db2 ne supportent pas ces
             nouvelles options.
              <variablelist>
                <varlistentry>
                  <term><parameter>i5_fetch_only</parameter></term>
                  <listitem>
                    <para>
                     <literal>DB2_I5_FETCH_ON</literal> - Les curseurs sont en
                     lecture seule et ne peuvent être utilisé pour positionner
                     des mises à jour et des suppressions. Ceci est la valeur
                     par défaut a moins que la variable d'environnement
                     <literal>SQL_ATTR_FOR_FETCH_ONLY</literal> ait été mis à
                     <literal>SQL_FALSE</literal>.
                    </para>
                    <para>
                     <literal>DB2_I5_FETCH_OFF</literal> - Les curseurs
                     peuvent être positionnés pour mises à jour et
                     suppressions.
                    </para>
                  </listitem>
                </varlistentry>
               </variablelist>
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><parameter>type</parameter></term>
          <listitem>
            <para>
             Un &integer; qui spécifie le type de ressource qui a été passé à
             la fonction. Le type de ressource et valeur doit correspondre.
              <variablelist>
                <varlistentry>
                  <term><parameter></parameter></term>
                  <listitem>
                    <para>
                     Passer <literal>1</literal> en tant que valeur spécifie
                     qu'une ressource de connexion a été passée à la fonction.
                    </para>
                    <para>
                     Passer n'importe quel &integer; non égal à
                     <literal>1</literal> en tant que valeur spécifie qu'une
                     ressource a été passée à la fonction.
                    </para>
                  </listitem>
                </varlistentry>
               </variablelist>
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </para>
    <para>
    </para>
    <para>
     Le tableau suivant spécifie quelles options sont compatibles avec quels
     types de ressources :
      <table>
        <title>Resource-Parameter Matrix</title>
        <tgroup cols="5">
          <colspec colnum="1" colname="col1" align="center" />
          <colspec colnum="2" colname="col2" align="center" />
          <colspec colnum="3" colname="col3" align="center" />
          <colspec colnum="4" colname="col4" align="center" />
          <colspec colnum="5" colname="col5" align="center" />
          
          <thead>
            <row>
              <entry morerows="1">Clé</entry>
              <entry morerows="1">Valeur</entry>
              <entry namest="col3" nameend="col5">Type de Ressource</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry colname="col3">Connexion</entry>
              <entry colname="col4">Requête</entry>
              <entry colname="col5">Jeu de Résultats</entry>
            </row>
            <row>
              <entry>autocommit</entry>
              <entry><literal>DB2_AUTOCOMMIT_ON</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">-</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>autocommit</entry>
              <entry><literal>DB2_AUTOCOMMIT_OFF</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">-</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>cursor</entry>
              <entry><literal>DB2_SCROLLABLE</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>cursor</entry>
              <entry><literal>DB2_FORWARD_ONLY</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>binmode</entry>
              <entry><literal>DB2_BINARY</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>binmode</entry>
              <entry><literal>DB2_CONVERT</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>binmode</entry>
              <entry><literal>DB2_PASSTHRU</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>db2_attr_case</entry>
              <entry><literal>DB2_CASE_LOWER</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>db2_attr_case</entry>
              <entry><literal>DB2_CASE_UPPER</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>db2_attr_case</entry>
              <entry><literal>DB2_CASE_NATURAL</literal></entry>
              <entry colname="col3">X</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>i5_fetch_only</entry>
              <entry><literal>DB2_I5_FETCH_ON</literal></entry>
              <entry colname="col3">-</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
            <row>
              <entry>i5_fetch_only</entry>
              <entry><literal>DB2_I5_FETCH_OFF</literal></entry>
              <entry colname="col3">-</entry>
              <entry colname="col4">X</entry>
              <entry colname="col5">-</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </para>
  </refsect1>
  
  <refsect1 role="returnvalues">
    &reftitle.returnvalues;
    <para>
     &return.success;
    </para>
  </refsect1>
  <!-- Place Changelog next if any -->
  
  <!-- Place Examples next if any -->
  <refsect1 role="examples">
    &reftitle.examples;
    <para>

      <example>
        <title>Fixer un paramètre à une ressource de connexion</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('autocommit' => DB2_AUTOCOMMIT_ON);

/* Appel de la fonction en utilisant le type correct de ressource, le tableau
 * d'options et la valeur type */
$result = db2_set_option($conn, $options, 1);

/* Vérifie si toutes les options peuvent être fixées correctement */
if($result)
{
  echo 'Options fixées correctement';	
}
else
{
  echo 'Impossible de fixer les options';
}
?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Options fixées correctement]]></screen>
      </example>

      <example>
        <title>Fixe des paramètres multiples avec une ressource de connexion</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('autocommit' => DB2_AUTOCOMMIT_OFF, 
	                'binmode' => DB2_PASSTHRU,
	          'db2_attr_case' => DB2_CASE_UPPER,
	              	 'cursor' => DB2_SCROLLABLE);

/* Appel de la fonction en utilisant le type correct de ressource, le tableau
 * d'options et la valeur type */
$result = db2_set_option($conn, $options, 1);

/* Vérifie si toutes les options peuvent être fixées correctement */
if($result)
{
  echo 'Options fixées correctement';	
}
else
{
  echo 'Impossible de fixer les options';
}
?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Options fixées correctement]]></screen>
      </example>

      <!-- Behaves Incorrectly -->
      <example>
        <title>Fixe des paramètres multiples avec une clé invalide</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('autocommit' => DB2_AUTOCOMMIT_OFF, 
	         'MY_INVALID_KEY' => DB2_PASSTHRU,
	          'db2_attr_case' => DB2_CASE_UPPER,
	                 'cursor' => DB2_SCROLLABLE);

/* Appel de la fonction en utilisant le type correct de ressource, le tableau
 * d'options et la valeur type */
$result = db2_set_option($conn, $options, 1);

/* Vérifie si toutes les options peuvent être fixées correctement */
if($result)
{
  echo 'Options fixées correctement';	
}
else
{
  echo 'Impossible de fixer les options';
}
?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Impossible de fixer les options]]></screen>
      </example>

      <!-- Behaves Incorrectly -->
      <example>
        <title>Fixe des paramètres multiples avec une valeur invalide</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('autocommit' => DB2_AUTOCOMMIT_OFF, 
	             	'binmode' => 'INVALID_VALUE',
	          'db2_attr_case' => DB2_CASE_UPPER,
	              	 'cursor' => DB2_SCROLLABLE);

/* Appel de la fonction en utilisant le type correct de ressource, le tableau
 * d'options et la valeur type */
$result = db2_set_option($conn, $options, 1);

/* Vérifie si toutes les options peuvent être fixées correctement */
if($result)
{
  echo 'Options fixées correctement';	
}
else
{
  echo 'Impossible de fixer les options';
}
?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Impossible de fixer les options]]></screen>
      </example>

      <example>
        <title>Fixe des paramètres multiples avec une ressource de connexion et un mauvais type</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('autocommit' => DB2_AUTOCOMMIT_OFF, 
	             	'binmode' => DB2_PASSTHRU,
	          'db2_attr_case' => DB2_CASE_UPPER,
	              	 'cursor' => DB2_SCROLLABLE);

/* Appel de la fonction en utilisant le type correct de ressource, le tableau
 * d'options et la valeur type invalide */
$result = db2_set_option($conn, $options, 2);

/* Vérifie si toutes les options peuvent être fixées correctement */
if($result)
{
  echo 'Options fixées correctement';	
}
else
{
  echo 'Impossible de fixer les options';
}
?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Impossible de fixer les options]]></screen>
      </example>

      <example>
        <title>Fixe des paramètres multiples avec une mauvaise ressource</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('autocommit' => DB2_AUTOCOMMIT_OFF, 
	             	'binmode' => DB2_PASSTHRU,
	          'db2_attr_case' => DB2_CASE_UPPER,
	                 'cursor' => DB2_SCROLLABLE);

$stmt = db2_prepare($conn, 'SELECT * FROM EMPLOYEE');              		  

/* Appel de la fonction en utilisant le type incorrect de ressource, mais le tableau
 * d'options et la valeur type valide */
$result = db2_set_option($stmt, $options, 1);

/* Vérifie si toutes les options peuvent être fixées correctement */
if($result)
{
  echo 'Options fixées correctement';	
}
else
{
  echo 'Impossible de fixer les options';
}
?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Impossible de fixer les options]]></screen>
      </example>

      <example>
        <title>Tout mettre ensemble</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
/* Paramètres de Connexion */
$database = 'SAMPLE';
$hostname = 'localhost';
$port = 50000;
$protocol = 'TCPIP';
$username = 'db2inst1';
$password = 'ibmdb2';

/* Chaînes de caractères de Connexion */
$conn_string = "DRIVER={IBM DB2 ODBC DRIVER};DATABASE=$database;";
$conn_string .= "HOSTNAME=$hostname;PORT=$port;PROTOCOL=$protocol;";
$conn_string .= "UID=$username;PWD=$password;";

/* Récupération de la Ressource de Connexion */
$conn = db2_connect($conn_string, '', '');

/* Crée le tableau associatif d'options avec des paires clé-valeur valides */
$options = array('db2_attr_case' => DB2_CASE_LOWER,
                        'cursor' => DB2_SCROLLABLE);

$stmt = db2_prepare($conn, 'SELECT * FROM EMPLOYEE WHERE EMPNO = ? OR EMPNO = ?');

/* Appel de la fonction en utilisant le type correct de ressource, le tableau
 * d'options et la valeur type */
$option_result = db2_set_option($stmt, $options, 2);		
$result = db2_execute($stmt, array('000130', '000140'));

/* Récupère la ligne 2 avant la ligne 1 puisque nous avons un curseur flottant */
print_r(db2_fetch_assoc($stmt, 2));
print '<br /><br />';
print_r(db2_fetch_assoc($stmt, 1));

?>
]]>
        </programlisting>
        &example.outputs;
        <screen><![CDATA[Array
(
    [empno] => 000140
    [firstnme] => HEATHER
    [midinit] => A
    [lastname] => NICHOLLS
    [workdept] => C01
    [phoneno] => 1793
    [hiredate] => 1976-12-15
    [job] => ANALYST
    [edlevel] => 18
    [sex] => F
    [birthdate] => 1946-01-19
    [salary] => 28420.00
    [bonus] => 600.00
    [comm] => 2274.00
)

Array
(
    [empno] => 000130
    [firstnme] => DELORES
    [midinit] => M
    [lastname] => QUINTANA
    [workdept] => C01
    [phoneno] => 4578
    [hiredate] => 1971-07-28
    [job] => ANALYST
    [edlevel] => 16
    [sex] => F
    [birthdate] => 1925-09-15
    [salary] => 23800.00
    [bonus] => 500.00
    [comm] => 1904.00
)]]></screen>
      </example>
      <example>
        <title>Les curseurs i5/OS sont en lecture seule</title>
        <para>
        </para>
        <programlisting role="php">
<![CDATA[
<?php
  $conn = db2_connect("", "", "", array("i5_lib"=>"nobody"));
  $stmt = db2_prepare($conn, 'select * from names where first = ?');
  $name = "first2";
  db2_bind_param($stmt, 1, "name", DB2_PARAM_IN);
  $options = array("i5_fetch_only"=>DB2_I5_FETCH_ON);
  db2_set_option($stmt,$options,0);
  if (db2_execute($stmt)) {
    while ($row = db2_fetch_array($stmt)) {
      echo "{$row[0]} {$row[1]}";
    }
  }
?>
]]>
        </programlisting>
        &example.outputs;
        <screen>
<![CDATA[
first2 last2
]]>
        </screen>
      </example>
    </para>
  </refsect1>
  <refsect1 role="seealso">
    &reftitle.seealso;
    <para>
      <simplelist>
        <member><function>db2_connect</function></member>
        <member><function>db2_pconnect</function></member>
        <member><function>db2_exec</function></member>
        <member><function>db2_prepare</function></member>
        <member><function>db2_cursor_type</function></member>
      </simplelist>
    </para>
  </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
