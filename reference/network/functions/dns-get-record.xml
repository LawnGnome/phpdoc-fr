<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.15 $ -->
<!-- EN-Revision: 1.20 Maintainer: yannick Status: ready -->
<!-- Reviewed: yes -->
  <refentry id="function.dns-get-record">
    <refnamediv>
     <refname>dns_get_record</refname>
     <refpurpose>
      Lit les données DNS associées à un hôte
     </refpurpose>
    </refnamediv>
    <refsect1>
    &reftitle.description;
      <methodsynopsis>
       <type>array</type><methodname>dns_get_record</methodname>
       <methodparam><type>string</type><parameter>hostname</parameter></methodparam>
       <methodparam choice="opt"><type>int</type><parameter>type</parameter></methodparam>
       <methodparam choice="opt"><type>array</type><parameter role="reference">authns</parameter></methodparam>
       <methodparam><type>array</type><parameter role="reference">addtl</parameter></methodparam>
      </methodsynopsis>
     <para>
      <note>
       <simpara>
        <methodname>dns_get_record</methodname> n'est pas implémentée 
        sur les plates-formes Windows. Utilisez la classe
        <ulink url="&url.php.pear;">PEAR</ulink> 
        <ulink url="&url.pear.package;Net_DNS">Net_DNS</ulink>.
       </simpara>
      </note>
     </para>
     <para>
      <methodname>dns_get_record</methodname> retourne un tableau associatif, contenant
      <emphasis>au minimum</emphasis> les index suivants :
      <table>
       <title>Attributs de base DNS</title>
       <tgroup cols="2">
        <thead>
         <row>
          <entry>Attribut</entry>
          <entry>Signification</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry><literal>host</literal></entry>
          <entry>
           L'enregistrement de l'espace de nom DNS qui est décrit par les autres
           données.
          </entry>
         </row>
         <row>
          <entry><literal>class</literal></entry>
          <entry>
           <function>dns_get_record</function> ne retourne que la classe d'enregistrement
           Internet et, en tant que tel, cet index vaudra toujours <literal>IN</literal>.
          </entry>
         </row>
         <row>
          <entry><literal>type</literal></entry>
          <entry>
           Chaîne de caractère contenant le type d'enregistrement. Des attributs 
           supplémentaires seront aussi disponibles dans le tableau suivant la
           valeur de ce type. Reportez-vous à la table ci-dessous.
          </entry>
         </row>
         <row>
          <entry><literal>ttl</literal></entry>
          <entry>
           Time To Live : Durée avant expiration de l'enregistrement. Cette valeur
           est <emphasis>différente</emphasis> de la durée avant expiration originale,
           mais plutôt cette valeur moins la durée depuis la dernière interrogation
           du serveur DNS responsable.
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
     <simpara>
      <parameter>hostname</parameter> doit être un nom d'hôte DNS valide, comme
      <literal>www.example.com</literal>. Des résolutions inversées peuvent
      être faites avec la notation in-addr.arpa, mais la fonction 
      <function>gethostbyaddr</function> est plus efficace pour faire des
      résolutions inverses.
     </simpara>
     <para>
      Par défaut, <function>dns_get_record</function> va rechercher toutes les
      ressources associées à <parameter>hostname</parameter>. Pour limiter la
      taille de la requête, le paramètre optionnel <parameter>type</parameter>
      peut prendre l'une des valeurs constantes suivantes : 
      <constant>DNS_A</constant>, <constant>DNS_CNAME</constant>, 
      <constant>DNS_HINFO</constant>, <constant>DNS_MX</constant>, 
      <constant>DNS_NS</constant>, <constant>DNS_PTR</constant>, 
      <constant>DNS_SOA</constant>, <constant>DNS_TXT</constant>, 
      <constant>DNS_AAAA</constant>, <constant>DNS_SRV</constant>,
      <constant>DNS_NAPTR</constant>, <constant>DNS_A6</constant>,
      <constant>DNS_ALL</constant> ou <constant>DNS_ANY</constant>.
      Par défaut, il vaut <emphasis>DNS_ANY</emphasis>.  
      <note>
       <para>
        A cause des performances excentriques de la bibliothèque libresolv,
        suivant les plates-formes, <constant>DNS_ANY</constant> ne retournera
        pas toujours tous les enregistrements, et l'option <constant>DNS_ALL</constant>,
        bien que plus lente, le fera de manière plus sûre.
       </para>
      </note>
     </para>
     <simpara>
       Les paramètres optionnels <parameter>authns</parameter> et 
       <parameter>addtl</parameter>
       sont passés par référence et, si fournis, ils recevront les enregistrements
       de ressources pour les <emphasis>Authoritative Name Servers</emphasis>,
       et tous les <emphasis>Additional Records</emphasis> respectivement.
       Voir l'exemple ci-dessous.
     </simpara>
     <para>
      <table>
       <title>Autres index disponibles suivant le type DNS</title>
       <tgroup cols="2">
        <thead>
         <row>
          <entry>Type</entry>
          <entry>Valeur supplémentaire</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry><literal>A</literal></entry>
          <entry>
           <literal>ip</literal> : une adresse IP v4, au format numérique.
          </entry>
         </row>
         <row>
          <entry><literal>MX</literal></entry>
          <entry>
           <literal>pri</literal> : priorité du serveur de mail.
           Les nombres faibles indiquent une priorité importante.
           <literal>target</literal> : FQDN du serveur de mail.
           Voir aussi <function>dns_get_mx</function>.
          </entry>
         </row>
         <row>
          <entry><literal>CNAME</literal></entry>
          <entry>
           <literal>target</literal> : FQDN du nom de l'espace DNS qui sert
           d'alias à cet enregistrement.
          </entry>
         </row>
         <row>
          <entry><literal>NS</literal></entry>
          <entry>
           <literal>target</literal> : FQDN du nom de serveur qui est responsable
           de ce nom de domaine.
          </entry>
         </row>
         <row>
          <entry><literal>PTR</literal></entry>
          <entry>
           <literal>target</literal> : nom de domaine vers lequel cet enregistrement
           pointe.
          </entry>
         </row>
          <row>
          <entry><literal>TXT</literal></entry>
          <entry>
           <literal>txt</literal> : chaîne de caractères arbitrairement associée
           à cet enregistrement.
          </entry>
         </row>
         <row>
          <entry><literal>HINFO</literal></entry>
          <entry>
           <literal>cpu</literal> : numéro IANA désignant le processeur de la machine
           référencée par cet enregistrement.
           <literal>os</literal> : numéro IANA désignant le système d'exploitation
           de la machine référencée par cet enregistrement.
           Voir <ulink url="&url.iana.system-names;">Operating System
           Names</ulink> pour connaître la signification
           de ces valeurs.
          </entry>
         </row>
         <row> 
          <entry><literal>SOA</literal></entry>
          <entry>
           <literal>mname</literal> : FQDN de la source de cet enregistrement.
           <literal>rname</literal> : adresse email du contact administratif de
           ce domaine.
           <literal>serial</literal> : numéro de série du nom de domaine.
           <literal>refresh</literal> : intervalle de rafraîchissement (en secondes)
           que les serveurs de noms secondaires doivent utiliser pour mettre
           en cache ce nom de domaine.
           <literal>retry</literal> : durée (en secondes) d'attente après un rafraîchissement
           échoué, avant de faire une seconde tentative.
           <literal>expire</literal> : durée maximale (en secondes) de conservation
           d'une copie des données de zone sans pouvoir faire de rafraichissement.
           <literal>minimum-ttl</literal> : durée minimale (en secondes) pendant laquelle un
           client conserve des données de zone avant qu'il ne soumette une nouvelle
           requête. Cette configuration peut être annulée par d'autres enregistrements.
          </entry>
         </row>
         <row>
          <entry><literal>AAAA</literal></entry>
          <entry>
           <literal>ipv6</literal> : adresse IPv6
          </entry>
         </row>
         <row>
          <entry><literal>A6</literal>(&php; &gt;= 5.1.0)</entry>
          <entry>
           <literal>masklen</literal> : longueur (en octets) à hériter depuis
           la cible spécifiée par <parameter>chain</parameter>.
           <literal>ipv6</literal> : adresse pour que cet enregistrement spécifique fusionne
           avec <parameter>chain</parameter>.
           <literal>chain</literal> : l'enregistrement parent à fusionner avec les données
           <parameter>ipv6</parameter>.
          </entry>
         </row>
         <row>
          <entry><literal>SRV</literal></entry>
          <entry>
           <literal>pri</literal> : (priorité) les priorités les plus basses doivent
           être utilisées en premier.
           <literal>weight</literal> : classement pour choisir aléatoirement parmi les 
           serveurs <parameter>targets</parameter>.
           <literal>target</literal> et <literal>port</literal> : nom d'hôte et
           port où le service est disponible.
           Pour plus d'informations, voir : <ulink url="&url.rfc;2782">RFC 2782</ulink>
          </entry>
         </row>
         <row>
          <entry><literal>NAPTR</literal></entry>
          <entry>
           <literal>order</literal> et <literal>pref</literal> : équivalent à
           <parameter>pri</parameter> et <parameter>weight</parameter> ci-dessus.
           <literal>flags</literal>, <literal>services</literal>, <literal>regex</literal>,
           et <literal>replacement</literal> : paramètres tels que définis
           dans la <ulink url="&url.rfc;2915">RFC 2915</ulink>.
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
     <para>
      <note>
       <para>
        En terme de standards DNS, les adresses email sont données au format
        utilisateur.hote (par exemple : webmestre.example.com au contraire du
        format webmestre@example.com). N'oubliez pas de vérifier cette adresse
        et de la modifier si nécessaire avant de la passer à la fonction
        <function>mail</function>.
       </para>
      </note>
     </para>
     <example>
      <title>Exemple avec <function>dns_get_record</function></title>
      <programlisting role="php">
<![CDATA[
<?php
$result = dns_get_record("php.net");
print_r($result);
?>
]]>
      </programlisting>
      &example.outputs;
      <screen>
<![CDATA[
Array
(
    [0] => Array
        (
            [host] => php.net
            [type] => MX
            [pri] => 5
            [target] => pair2.php.net
            [class] => IN
            [ttl] => 6765
        )

    [1] => Array
        (
            [host] => php.net
            [type] => A
            [ip] => 64.246.30.37
            [class] => IN
            [ttl] => 8125
        )

)
*/
]]>
      </screen>
     </example>
     <simpara>
      Comme il est très courant de rechercher l'IP d'un serveur,
      une fois que le champ MX a été résolu, <function>dns_get_record</function>
      retournera aussi un tableau dans le paramètre <parameter>addtl</parameter> 
      qui contiendra les enregistrements associés. <parameter>authns</parameter>
      est aussi retourné en contenant une liste des serveurs autorité.
     </simpara>
     <example>
      <title>Exemple avec <function>dns_get_record</function> et DNS_ANY</title>
      <programlisting role="php">
<![CDATA[
<?php
/* Demande tous ("ANY") les enregistrements pour php.net, 
   puis crée les tableaus $authns et $addtl
   contenant une liste des noms de serveurs, et tous
   les enregistrements qui vont avec
    */
$result = dns_get_record("php.net",DNS_ANY,$authns,$addtl);
echo 'Résultat = ';
print_r($result);
echo 'Authorité NS = ';
print_r($authns);
echo 'Additionnel = ';
print_r($addtl);
?>
]]>
      </programlisting>
      &example.outputs;
      <screen>
<![CDATA[
Résultat = Array
(
    [0] => Array
        (
            [host] => php.net
            [type] => MX
            [pri] => 5
            [target] => pair2.php.net
            [class] => IN
            [ttl] => 6765
        )

    [1] => Array
        (
            [host] => php.net
            [type] => A
            [ip] => 64.246.30.37
            [class] => IN
            [ttl] => 8125
        )

)
Authortité NS = Array
(
    [0] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => remote1.easydns.com
            [class] => IN
            [ttl] => 10722
        )

    [1] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => remote2.easydns.com
            [class] => IN
            [ttl] => 10722
        )

    [2] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => ns1.easydns.com
            [class] => IN
            [ttl] => 10722
        )

    [3] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => ns2.easydns.com
            [class] => IN
            [ttl] => 10722
        )

)
Additionnel = Array
(
    [0] => Array
        (
            [host] => pair2.php.net
            [type] => A
            [ip] => 216.92.131.5
            [class] => IN
            [ttl] => 6766
        )

    [1] => Array
        (
            [host] => remote1.easydns.com
            [type] => A
            [ip] => 64.39.29.212
            [class] => IN
            [ttl] => 100384
        )

    [2] => Array
        (
            [host] => remote2.easydns.com
            [type] => A
            [ip] => 212.100.224.80
            [class] => IN
            [ttl] => 81241
        )

    [3] => Array
        (
            [host] => ns1.easydns.com
            [type] => A
            [ip] => 216.220.40.243
            [class] => IN
            [ttl] => 81241
        )

    [4] => Array
        (
            [host] => ns2.easydns.com
            [type] => A
            [ip] => 216.220.40.244
            [class] => IN
            [ttl] => 81241
        )

)
*/
]]>
      </screen>
     </example>
     <simpara>
      Voir aussi
      <function>dns_get_mx</function> et
      <function>dns_check_record</function>.
     </simpara>
    </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
