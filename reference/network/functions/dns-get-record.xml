<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.2 $ -->
  <refentry id="function.dns-get-record">
    <refnamediv>
     <refname>dns_get_record</refname>
     <refpurpose>
      Lit les donn&eacute;es DNS associ&eacute;es &agrave; un h&ocirc;te
     </refpurpose>
    </refnamediv>
    <refsect1>
     <title>Description</title>
      <methodsynopsis>
       <type>array</type><methodname>dns_get_record</methodname>
       <methodparam><type>string</type><parameter>hostname</parameter></methodparam>
       <methodparam choice="opt"><type>int</type><parameter>type</parameter></methodparam>
       <methodparam choice="opt"><type>array</type><parameter>&amp;authns</parameter></methodparam>
       <methodparam><type>array</type><parameter>&amp;addtl</parameter></methodparam>
      </methodsynopsis>
     <para>
      <note>
       <simpara>
        <methodname>dns_get_record</methodname> n'est pas impl&eacute;ment&eacute;e 
        sur les plate-formes Windows. Utilisez alors la classe
        <ulink url="&url.php.pear;">PEAR</ulink> 
        <ulink url="&url.pear.net-dns;">Net_DNS</ulink>.
       </simpara>
      </note>
     </para>
     <para>
      <methodname>dns_get_record</methodname> retourne un tabluau associatif, contenant
      <emphasis>au minimum</emphasis> les index suivants : <literal>host</literal>, 
      <literal>type</literal>, <literal>class</literal>, <literal>ttl</literal>.
      <table>
       <title>Attributs de base DNS</title>
       <tgroup cols="2">
        <thead>
         <row>
          <entry>Attribut</entry>
          <entry>Signification</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry><literal>host</literal></entry>
          <entry>
           L'enregistrement de l'espace de nom DNS qui est d&eacute;crit par les autres
           donn&eacute;es.
          </entry>
         </row>
         <row>
          <entry><literal>class</literal></entry>
          <entry>
           <function>dns_get_record</function> ne retourne que la classe d'enregistrement
           Internet et en tant que tel, cet index vaudra toujours <literal>IN</literal>.
          </entry>
         </row>
         <row>
          <entry><literal>type</literal></entry>
          <entry>
           Cha&icirc;ne de caract&egrave;re contenant le type d'enregistrement. Des attributs 
           suppl&eacute;mentaires seront aussi disponbiles dans le tableau suivant la
           valeur de ce type. Reportez-vous &agrave; la table ci-dessous.
          </entry>
         </row>
         <row>
          <entry><literal>ttl</literal></entry>
          <entry>
           Time To Live : Dur&eacute;e avant expiration de l'enregistrement. Cette valeur
           est <emphasis>diff&eacute;rente</emphasis> de la dur&eacute;e avant expiration originale,
           mais plut&ocirc;t cette valeur moins la dur&eacute;e depuis la derni&egrave;re interrogation
           du serveur DNS responsable.
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
     <simpara>
      <parameter>hostname</parameter> doit &ecirc;tre un nom d'h&ocirc;te DNS valide, comme
      par exemple <literal>www.exemple.com</literal>. Des r&eacute;solutions invers&eacute;es peuvent
      &ecirc;tre faites avec la notation in-addr.arpa, mais la fonction 
      <function>gethostbyaddr</function> est plus efficace pour faire des
      r&eacute;solutions inverses.
     </simpara>
     <para>
      Par d&eacute;faut, <function>dns_get_record</function> va rechercher toutes les
      ressources associ&eacute;es &agrave; <parameter>hostname</parameter>. Pour limiter la
      taille de la requ&ecirc;te, le param&egrave;tre optionnel <parameter>type</parameter>
      peut prendre l'une des valeurs constantes suivantes : 
      <constant>DNS_A</constant>, <constant>DNS_CNAME</constant>, 
      <constant>DNS_HINFO</constant>, <constant>DNS_MX</constant>, 
      <constant>DNS_NS</constant>, <constant>DNS_PTR</constant>, 
      <constant>DNS_SOA</constant>, <constant>DNS_TXT</constant>, 
      <constant>DNS_ALL</constant> et <constant>DNS_ANY</constant>.
      Par d&eacute;faut, il vaut <emphasis>DNS_ANY</emphasis>.  
      <note>
       <para>
        A cause des performances excentriques de la librairie libresolv,
        suivant les plate-formes, <constant>DNS_ANY</constant> ne retournera
        pas toujours tous les enregistrements, et l'option <constant>DNS_ALL</constant>,
        bien que plus lente, le fera de mani&egrave;re plus s&ucirc;re.
       </para>
      </note>
     </para>
     <simpara>
       Les param&egrave;tres optionnels <parameter>authns</parameter> et <parameter>addtl</parameter>
       sont pass&eacute; par r&eacute;f&eacute;rence, et si fournis, ils recevront les enregistrements
       de ressources pour les <emphasis>Authoritative Name Servers</emphasis>,
       et tous les <emphasis>Additional Records</emphasis> respectivement.
       Voir l'exemple ci-dessous.
     </simpara>
     <para>
      Suivant le type de valeur de l'index <literal>type</literal>, le tableau
      associatif peut aussi contenir les index suivants :
      <literal>ip</literal>, <literal>pri</literal>, <literal>target</literal>, 
      <literal>cpu</literal>, <literal>os</literal>, <literal>mname</literal>, 
      <literal>rname</literal>, <literal>serial</literal>, <literal>refresh</literal>,
      <literal>retry</literal>, <literal>expire</literal>, <literal>minimum-ttl</literal>, 
      <literal>txt</literal>.
     </para>
     <para>
      <table>
       <title>Autres index disponibles suivant le type DNS</title>
       <tgroup cols="2">
        <thead>
         <row>
          <entry>Type</entry>
          <entry>Valeur suppl&eacute;mentaire</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry><literal>A</literal></entry>
          <entry>
           <literal>ip</literal>: Une adresse IP v4, au format num&eacute;rique.
          </entry>
         </row>
         <row>
          <entry><literal>MX</literal></entry>
          <entry>
           <literal>pri</literal>: Priorit&eacute; du serveur de mail.
           Les nombres faibles indiquent une priorit&eacute; importante.
           <literal>target</literal>: FQDN du serveur de mail.
           Voir aussi <function>dns_get_mx</function>.
          </entry>
         </row>
         <row>
          <entry><literal>CNAME</literal></entry>
          <entry>
           <literal>target</literal>: FQDN du nom de l'espace DNS qui sert
           d'alias &agrave; cet enregistrement.
          </entry>
         </row>
         <row>
          <entry><literal>NS</literal></entry>
          <entry>
           <literal>target</literal>: FQDN du nom de serveur qui est responsable
           de ce nom de domaine.
          </entry>
         </row>
         <row>
          <entry><literal>PTR</literal></entry>
          <entry>
           <literal>target</literal>: Nom de domaine sur lequel cet enregistrement
           pointe.
          </entry>
         </row>
          <row>
          <entry><literal>TXT</literal></entry>
          <entry>
           <literal>txt</literal>: Cha&icirc;ne de caract&egrave;res arbitrairement associ&eacute;e
           &agrave; cet enregistrement.
          </entry>
         </row>
         <row>
          <entry><literal>HINFO</literal></entry>
          <entry>
           <literal>cpu</literal>: Num&eacute;ro IANA d&eacute;signant le processeur de la machine
           r&eacute;f&eacute;renc&eacute;e par cet enregistrement.
           <literal>os</literal>: Num&eacute;ro IANA d&eacute;signant le syst&egrave;me d'exploitation
           de la machine r&eacute;f&eacute;renc&eacute;e par cet enregistrement.
           Voir <ulink url="&url.iana.system-names;">Operating System
           Names</ulink> pour conna&icirc;tre la signification
           de ces valeurs.
          </entry>
         </row>
         <row> 
          <entry><literal>SOA</literal></entry>
          <entry>
           <literal>mname</literal>: FQDN de la source de cet enregistrement.
           <literal>rname</literal>: Adresse email du contact administratif de
           ce domaine.
           <literal>serial</literal>: Num&eacute;ro de s&eacute;rie du nom de domaine.
           <literal>refresh</literal>: Interval de rafra&icirc;chissement (en secondes)
           que les serveurs de noms secondaires doivent utiliser pour mettre
           en cache ce nom de domaine.
           <literal>retry</literal>: Dur&eacute;e (en seconde) d'attente apr&egrave;s un rafra&icirc;chissement
           &eacute;chou&eacute;, avant de faire une seconde tentative.
           <literal>expire</literal>: Dur&eacute;e maximale (en seconde) de conservation
           d'une copie des donn&eacute;es de zone sans pouvoir faire de rafraichissement.
           <literal>minimum-ttl</literal>: Dur&eacute;e minimale (en seconde) pour un
           client conserve des donn&eacute;es de zone avant qu'il ne soumette une nouvelle
           requ&ecirc;te. Cette configuration peut &ecirc;tre annul&eacute;e par d'autres enregistrements.
          </entry>
         </row>
         <row>
          <entry><literal>AAAA</literal></entry>
          <entry>
           <literal>ipv6</literal>: adresse IPv6
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
     <para>
      <note>
       <para>
        En terme de standards DNS, les adresses email sont donn&eacute;es au format
        utilisateur.hote (par exemple : webmestre.exemple.com au contraire du
        format webmestre@exemple.com). N'oubliez pas de v&eacute;rifier cette adresse
        et de la modifier si n&eacute;cessaire avant de la passer &agrave; la fonction
        <function>mail</function>.
       </para>
      </note>
     </para>
     <example>
      <title>Exemple avec <function>dns_get_record</function></title>
      <programlisting role="php">
<![CDATA[
<?php
$result = dns_get_record("php.net");
print_r($result);
?>

/*
Produit un affichage similaire &agrave; ceci : 
----------------------------------------

Array
(
    [0] => Array
        (
            [host] => php.net
            [type] => MX
            [pri] => 5
            [target] => pair2.php.net
            [class] => IN
            [ttl] => 6765
        )

    [1] => Array
        (
            [host] => php.net
            [type] => A
            [ip] => 64.246.30.37
            [class] => IN
            [ttl] => 8125
        )

)
*/
]]>
      </programlisting>
     </example>
     <simpara>
      Comme il est tr&egrave;s courant de rechercher l'IP d'un serveur,
      une fois que le champs MX a &eacute;t&eacute; r&eacute;solu, <function>dns_get_record</function>
      retournera aussi un tableau dans le param&egrave;tre <parameter>addtl</parameter> 
      qui contiendra les enregistrements associ&eacute;s. <parameter>authns</parameter>
      est aussi retourn&eacute; en contenant une liste des serveurs autorit&eacute;.
     </simpara>
     <example>
      <title>Exemple avec <function>dns_get_record</function> et DNS_ANY</title>
      <programlisting role="php">
<![CDATA[
<?php
/* Demande tous ("ANY") les enregistrements pour php.net, 
   pu cr&eacute;e les tableaus $authns et $addtl
   contenant une liste des noms de serveurs, et tous
   les enregistrements qui vont avec
    */
$result = dns_get_record("php.net",DNS_ANY,$authns,$addtl);
print "R&eacute;sultat = ";
print_r($result);
print "Authorit&eacute; NS = ";
print_r($authns);
print "Additionnel = ";
print_r($addtl);
?>

/*
Produit un affichage similaire &agrave; ceci : 
-----------------------------------------

R&eacute;sultat = Array
(
    [0] => Array
        (
            [host] => php.net
            [type] => MX
            [pri] => 5
            [target] => pair2.php.net
            [class] => IN
            [ttl] => 6765
        )

    [1] => Array
        (
            [host] => php.net
            [type] => A
            [ip] => 64.246.30.37
            [class] => IN
            [ttl] => 8125
        )

)
Authortit&eacute; NS = Array
(
    [0] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => remote1.easydns.com
            [class] => IN
            [ttl] => 10722
        )

    [1] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => remote2.easydns.com
            [class] => IN
            [ttl] => 10722
        )

    [2] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => ns1.easydns.com
            [class] => IN
            [ttl] => 10722
        )

    [3] => Array
        (
            [host] => php.net
            [type] => NS
            [target] => ns2.easydns.com
            [class] => IN
            [ttl] => 10722
        )

)
Additionnel = Array
(
    [0] => Array
        (
            [host] => pair2.php.net
            [type] => A
            [ip] => 216.92.131.5
            [class] => IN
            [ttl] => 6766
        )

    [1] => Array
        (
            [host] => remote1.easydns.com
            [type] => A
            [ip] => 64.39.29.212
            [class] => IN
            [ttl] => 100384
        )

    [2] => Array
        (
            [host] => remote2.easydns.com
            [type] => A
            [ip] => 212.100.224.80
            [class] => IN
            [ttl] => 81241
        )

    [3] => Array
        (
            [host] => ns1.easydns.com
            [type] => A
            [ip] => 216.220.40.243
            [class] => IN
            [ttl] => 81241
        )

    [4] => Array
        (
            [host] => ns2.easydns.com
            [type] => A
            [ip] => 216.220.40.244
            [class] => IN
            [ttl] => 81241
        )

)
*/
]]>
      </programlisting>
     </example>
     <simpara>
      Voir aussi
       <function>dns_get_mx</function> et
       <function>dns_check_record</function>
     </simpara>
    </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
