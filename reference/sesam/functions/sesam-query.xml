<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.14 $ -->
<!-- EN-Revision: 1.8 Maintainer: yannick Status: ready -->
<!-- Reviewed: yes -->

<refentry xml:id="function.sesam-query" xmlns="http://docbook.org/ns/docbook">
 <refnamediv>
  <refname>sesam_query</refname>
  <refpurpose>Exécute une requête SESAM</refpurpose>
 </refnamediv>

 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type>string</type><methodname>sesam_query</methodname>
   <methodparam><type>string</type><parameter>query</parameter></methodparam>
   <methodparam choice="opt"><type>bool</type><parameter>scrollable</parameter></methodparam>
  </methodsynopsis>
  <para>
   <function>sesam_query</function> envoie une requête à la base
   active. Elle peut exécuter aussi bien une requête immédiate
   (DELETE, UPDATE ou INSERT), ou une requête de selection.
   Si une requête immédiate est exécutée, aucun curseur n'est
   alloué, et il ne sera pas possible d'utiliser les fonctions
   <function>sesam_fetch_row</function> ou
   <function>sesam_fetch_result</function>.
  </para>
  <para>
   Lorsque vous utilisez les curseurs à défilement, le curseur
   peut être positionné librement dans le résultat. Pour chaque
   requête à défilement, il existe des valeurs globales de
   types de défilement (initialisée à :<literal>SESAM_SEEK_NEXT</literal>)
   et la position peut être fixée une seule fois par
   <function>sesam_seek_row</function> ou bien à chaque appel,
   avec la fonction <function>sesam_fetch_row</function>.
  </para>
  <para>
   Pour les requêtes immédiates, le nombre de lignes affectées est
   sauvé, et est accessible par la fonction <function>sesam_affected_rows</function>.
  </para>
 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;
  <para>
   <variablelist>
    <varlistentry>
     <term><parameter>query</parameter></term>
     <listitem>
      <para>
       La requête.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>scrollable</parameter></term>
     <listitem>
      <para>
       Pour les requêtes de selection, un descripteur de résultat et un curseur
       (scrollable ou séquentiel, suivant le paramètre optionnel
       <parameter>scrollable</parameter> passé) sera alloué.
       Si <parameter>scrollable</parameter> est omis, le curseur sera
       séquentiel.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
 </refsect1>

 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <para>
   Retourne un identifiant de résultat SESAM en cas de succès,
   ou &false; en cas d'erreur. L'identifiant de résultat est utilisé
   par d'autres fonctions SESAM pour lire les valeurs.
  </para>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <para>
   <example>
    <title>Liste toutes les lignes de table "phone" sous forme de table HTML</title>
    <programlisting role="php">
<![CDATA[
<?php
if (!sesam_connect("phonedb", "demo", "otto"))
    die("Connexion impossible");
$result = sesam_query("select * from phone");
if (!$result) {
    $err = sesam_diagnostic();
    die ($err["errmsg"]);
}
echo "<table border>\n";
// Ajoute l'en-tête de titre comme nom de colonne
if ($cols = sesam_field_array($result)) {
    echo "<tr><th colspan=" . $cols["count"] . ">Result:</th></tr>\n";
    echo "<tr>\n";
    for ($col = 0; $col < $cols["count"]; ++$col) {
        $colattr = $cols[$col];
        /* Span the table head over SESAM's "Multiple Fields": */
        if ($colattr["count"] > 1) {
            echo "<th colspan=\"" . $colattr["count"] . "\">" . $colattr["name"] .
                "(1.." . $colattr["count"] . ")</th>\n";
            $col += $colattr["count"] - 1;
        } else
            echo "<th>" . $colattr["name"] . "</th>\n";
    }
    echo "</tr>\n";
}

do {
    // Lit les résultats par bloc de 100
    $ok = sesam_fetch_result($result, 100);
    for ($row=0; $row < $ok["rows"]; ++$row) {
        echo " <tr>\n";
        for ($col = 0; $col < $ok["cols"]; ++$col) {
            if (isset($ok[$col][$row])) {
                echo "<td>" . $ok[$col][$row] . "</td>\n";
            } else {
                echo "<td>-empty-</td>\n";
            }
        }
        echo "</tr>\n";
    }
} while ($ok["truncated"]); // tant qu'il y a encore des données

echo "</table>\n";
// libère les ressources
sesam_free_result($result);
?>
]]>
    </programlisting>
   </example>
  </para>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <para>
   <simplelist>
    <member><function>sesam_fetch_row</function></member>
    <member><function>sesam_fetch_result</function></member>
   </simplelist>
  </para>
 </refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->