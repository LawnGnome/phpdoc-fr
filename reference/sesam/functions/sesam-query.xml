<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.6 $ -->

<!-- splitted from ./fr/functions/sesam.xml, last change in rev 1.1 -->
<!-- last change to 'sesam-query' in en/ tree in rev 1.1 -->
  <refentry id="function.sesam-query">
   <refnamediv>
    <refname>sesam_query</refname>
    <refpurpose>Exécute une requête SESAM</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Description</title>
     <methodsynopsis>
      <type>string</type><methodname>sesam_query</methodname>
      <methodparam><type>string</type><parameter>query</parameter></methodparam>
      <methodparam choice="opt"><type>bool</type><parameter>scrollable</parameter></methodparam>
     </methodsynopsis>
    <para>
     <function>sesam_query</function> retourne un identifiant de résultat
     SESAM en cas de succès, ou &false; en cas d'erreur.
    </para>
    <para>
     L'identifiant de résultat est utilisé par d'autres fonctions
     sesam pour lire les valeurs.
    </para>
    <para>
     <function>sesam_query</function> envoie une requête à la base
     active. Elle peut exécuter aussi bien une requête immédiate
     (DELETE, UPDATE ou INSERT), ou une requête de selection.
     Si une requête immédiate est exécutée, aucun curseur n'est
     alloué, et il ne sera pas possible d'utiliser les fonctions
     <function>sesam_fetch_row</function> ou
     <function>sesam_fetch_result</function>. Pour les requêtes de
     selection, un descripteur de résultat et un curseur
     (scrollable ou séquentiel, suivant le paramètre optionnel
     <parameter>scrollable</parameter> passé) sear alloué.
     Si <parameter>scrollable</parameter> est omis, le curseur sera
     séquentiel.
    </para>
    <para>
     Lorsque vous utilisez les curseurs à défilement, le curseur
     peut être positionné librement dans le résultat. Pour chaque
     requête à défilement, il existe des valeurs globales de
     types de défilement (initialisée à :<literal>SESAM_SEEK_NEXT</literal>)
     et la position peut être fixée une seule fois par
     <function>sesam_seek_row</function> ou bien à chaque appel,
     avec la fonction <function>sesam_fetch_row</function>.
    </para>
    <para>
     Pour les requêtes immédiates, le nombre de lignes affectées est
     sauvé, et est accessible par la fonction <function>sesam_affected_rows</function>.
    </para>
    <para>
     Voir aussi : <function>sesam_fetch_row</function> et
     <function>sesam_fetch_result</function>.
     <example>
      <title>
       Liste toutes les lignes de table "phone" sous forme de table HTML
      </title>
      <programlisting role="php">
<![CDATA[
<?php
if (!sesam_connect("phonedb", "demo", "toto"))
  die("cannot connect");
$result = sesam_query("select * from phone");
if (!$result) {
  $err = sesam_diagnostic();
  die($err["errmsg"]);
}
echo "<TABLE BORDER>\n";
// Ajoute l'en-tête de titre comme nom de colonne
if ($cols = sesam_field_array($result)) {
  echo " <TR><TH COLSPAN=".$cols["count"].">Result:</TH></TR>\n";
  echo " <TR>\n";
  for ($col = 0; $col < $cols["count"]; ++$col) {
    $colattr = $cols[$col];
    /* étend les en-têtes de la table au dessus des champs multiples */
    if ($colattr["count"] > 1) {
      echo "  <TH COLSPAN=".$colattr["count"].">".$colattr["name"].
           "(1..".$colattr["count"].")</TH>\n";
      $col += $colattr["count"] - 1;
    }
    else
      echo "  <TH>" . $colattr["name"] . "</TH>\n";
  }
  echo " </TR>\n";
}
do {
  // Lit les résultats par bloc de 100
  $ok = sesam_fetch_result($result,100);
  for ($row=0; $row < $ok["rows"]; ++$row) {
    echo " <TR>\n";
    for ($col = 0; $col < $ok["cols"]; ++$col) {
      if (isset($ok[$col][$row]))
        echo "  <TD>" . $ok[$col][$row] . "</TD>\n";
      else
        echo "  <TD>-empty-</TD>\n";
    }
    echo " </TR>\n";
  }
} while ($ok["truncated"]); // tant qu'il a y encore des données
echo "</TABLE>\n";
// libère les ressources
sesam_free_result($result);
?>
]]>
      </programlisting>
     </example>
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
